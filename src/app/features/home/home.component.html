<div class="home-container">
  <section class="hero-section">
    <div class="hero-background-elements">
      <div class="hero-circle hero-circle-1"></div>
      <div class="hero-circle hero-circle-2"></div>
      <div class="hero-circle hero-circle-3"></div>
    </div>
    <div class="hero-content">
      <div class="hero-icon-wrapper">
        <mat-icon class="hero-main-icon">groups</mat-icon>
      </div>
      <h1 class="hero-title">Manage Your Samiti Digitally</h1>
      <p class="hero-subtitle">Apne Mandal ya Group ka hisaab-kitaab rakhein ekdam asaan aur transparent.</p>
      <div class="hero-actions">
        <button mat-raised-button color="primary" (click)="onCreateSamiti()" class="hero-primary-btn">
          <mat-icon>add</mat-icon>
          <span>CREATE NEW SAMITI</span>
        </button>
      </div>
    </div>
  </section>
  <hr class="section-divider" />
  <section class="near-you-section">
    <div class="section-header">
      <h2>Explore Active Events</h2>
      <div class="search-bar-wrapper">
        <mat-icon class="search-icon">search</mat-icon>
        <input
          #searchInput
          type="text"
          class="search-input"
          placeholder="Search group ..."
          (input)="onSearchGroups($event)"
        />
        <button
          *ngIf="searchTerm"
          mat-icon-button
          type="button"
          class="search-clear-btn"
          (click)="clearSearch(searchInput)"
          aria-label="Clear search"
          title="Clear search"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
    <div class="group-grid" *ngIf="samitiGroups.length > 0">
      <mat-card class="group-card" *ngFor="let group of samitiGroups">
        <div class="group-header-enhanced">
          <div class="header-background"></div>
          <div class="header-content">
            <div class="header-main">
              <ng-container *ngIf="!(locationName$ | async); else groupLogo">
                <div class="group-avatar skeleton skeleton-avatar" aria-label="Loading group logo"></div>
              </ng-container>
              <ng-template #groupLogo>
                <img [src]="group.logo || getGroupLogoUrl(group.name)" class="group-avatar" alt="{{group.name}}" />
              </ng-template>
              <div class="group-details">
                <ng-container *ngIf="!(locationName$ | async); else groupNameText">
                  <h3 class="group-name clickable-title">
                    <span class="skeleton skeleton-info" style="width: 60%; height: 28px;"></span>
                  </h3>
                </ng-container>
                <ng-template #groupNameText>
                  <h3 class="group-name clickable-title" (click)="openGroupProfile(group)">{{ group.name }}</h3>
                </ng-template>
                <div class="header-info">
                  <ng-container *ngIf="!(locationName$ | async); else locationText">
                    <div class="info-item location-clickable">
                      <span class="skeleton skeleton-info" style="width: 80px; height: 18px;"></span>
                    </div>
                  </ng-container>
                  <ng-template #locationText>
                    <div
                      class="info-item location-clickable"
                      (click)="$event.stopPropagation(); openMap(group.location)"
                      title="Open in Maps"
                    >
                      <mat-icon>location_on</mat-icon>
                      <span>{{ group.location }}</span>
                    </div>
                  </ng-template>
                  <div class="info-divider"></div>
                  <ng-container *ngIf="!(locationName$ | async); else sinceText">
                    <div class="info-item">
                      <span class="skeleton skeleton-info" style="width: 70px; height: 18px;"></span>
                    </div>
                  </ng-container>
                  <ng-template #sinceText>
                    <div class="info-item">
                      <mat-icon>calendar_today</mat-icon>
                      <span>Since {{ group.since }}</span>
                    </div>
                  </ng-template>
                  <div class="info-divider"></div>
                  <ng-container *ngIf="!(locationName$ | async); else eventsCountText">
                    <div class="info-item">
                      <span class="skeleton skeleton-info" style="width: 60px; height: 18px;"></span>
                    </div>
                  </ng-container>
                  <ng-template #eventsCountText>
                    <div class="info-item" [title]="group.events.length + ' Events'">
                      <mat-icon>event</mat-icon>
                      <span>{{ group.events.length }} Event{{ group.events.length !== 1 ? 's' : '' }}</span>
                    </div>
                  </ng-template>
                  <div class="info-divider" *ngIf="group.contactNumbers && group.contactNumbers.length > 0"></div>
                  <ng-container *ngIf="!(locationName$ | async); else contactNumbersText">
                    <div class="info-item">
                      <span class="skeleton skeleton-info" style="width: 100px; height: 18px;"></span>
                    </div>
                  </ng-container>
                  <ng-template #contactNumbersText>
                    <div class="info-item" *ngIf="group.contactNumbers && group.contactNumbers.length > 0">
                      <mat-icon>phone</mat-icon>
                      <span>{{ group.contactNumbers.join(', ') }}</span>
                    </div>
                  </ng-template>
                </div>
                <ng-container *ngIf="!(locationName$ | async); else descriptionText">
                  <p class="group-description">
                    <span class="skeleton skeleton-info" style="width: 80%; height: 16px; margin-bottom: 6px;"></span>
                  </p>
                </ng-container>
                <ng-template #descriptionText>
                  <p class="group-description">{{ group.description }}</p>
                </ng-template>
              </div>
            </div>
            <div class="header-actions">
              <div class="group-id-info" *ngIf="group.groupId">
                <ng-container *ngIf="!(locationName$ | async); else groupIdContent">
                  <span class="skeleton skeleton-info" style="width: 220px; height: 36px; border-radius: 18px; margin-top: 10px;"></span>
                </ng-container>
                <ng-template #groupIdContent>
                  <span class="group-id-label">Group Id:</span>
                  <span class="group-id-value">{{ group.groupId }}</span>
                  <ng-container *ngIf="!(locationName$ | async); else copyBtnContent">
                    <span class="skeleton skeleton-info" style="width: 220px; height: 36px; border-radius: 18px;"></span>
                  </ng-container>
                  <ng-template #copyBtnContent>
                    <button
                      mat-icon-button
                      type="button"
                      class="copy-icon"
                      (click)="copyToClipboard(group.groupId)"
                      aria-label="Copy Group ID"
                      title="Copy Group ID"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </ng-template>
                </ng-template>
              </div>
              <ng-container *ngIf="!(locationName$ | async); else joinBtnContent">
                <span class="skeleton skeleton-info" style="width: 140px; height: 44px; border-radius: 22px;"></span>
              </ng-container>
              <ng-template #joinBtnContent>
                <button
                  mat-raised-button
                  color="primary"
                  (click)="$event.stopPropagation(); openJoinGroupDialog(group)"
                  class="join-btn"
                >
                  <mat-icon>group_add</mat-icon>
                  <span>JOIN GROUP</span>
                </button>
              </ng-template>
            </div>
          </div>
        </div>
        <mat-tab-group mat-align-tabs="left" class="tabs-fixed-width" [selectedIndex]="selectedYearIndex">
          <mat-tab *ngFor="let year of years" [label]="year.toString()">
            <div class="events-section">
              <div class="events-grid-enhanced">
                <div class="event-card-enhanced" *ngFor="let event of group.events" [attr.data-status]="event.status">
                  <!-- Status indicator bar -->
                  <div class="event-status-bar" [attr.data-status]="event.status"></div>
                  <div class="event-card-body">
                    <swiper-container
                      *ngIf="event?.images?.length"
                      class="event-carousel"
                      [slidesPerView]="1"
                      [spaceBetween]="8"
                      [navigation]="true"
                      [pagination]="carouselPagination"
                      [autoplay]="carouselAutoplay"
                      [loop]="event.images.length > 2"
                    >
                      <swiper-slide *ngFor="let image of event.images">
                        <img class="event-carousel-image" [src]="image" [alt]="event.title + ' image'" loading="lazy" />
                      </swiper-slide>
                    </swiper-container>
                    <!-- Event Header -->
                    <div class="event-card-header">
                      <h5 class="event-card-title">{{ event.title }}</h5>
                      <span class="event-year-badge-new" [attr.data-status]="event.status">
                        ‚≠ê {{ getYearLabel(event.year_count) }}
                      </span>
                    </div>

                    <!-- Event Description -->
                    <p class="event-card-description">{{ event.description }}</p>

                    <!-- Event Meta Information -->
                    <div class="event-card-meta">
                      <div class="meta-row">
                        <mat-icon>calendar_today</mat-icon>
                        <span class="meta-text">
                          {{ event.start_date | date:'MMM d, yyyy' }} - {{ event.end_date | date:'MMM d, yyyy' }}
                        </span>
                      </div>

                      <div
                        class="meta-row clickable"
                        (click)="$event.stopPropagation(); openMap(event.location)"
                        title="Open in Maps"
                      >
                        <mat-icon>location_on</mat-icon>
                        <span class="meta-text">{{ event.location }}</span>
                      </div>
                    </div>

                    <!-- Event Footer -->
                    <div class="event-card-footer">
                      <span class="event-status-chip" [attr.data-status]="event.status">
                        <mat-icon
                          >{{ event.status === 'started' ? 'play_circle' : event.status === 'completed' ? 'check_circle'
                          : 'schedule' }}</mat-icon
                        >
                        {{ event.status | titlecase }}
                      </span>

                      <button mat-button class="event-details-btn" (click)="openEventDetails(event)">
                        Details
                        <mat-icon>arrow_forward</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Empty State -->
              <div class="empty-state" *ngIf="!group.events || group.events.length === 0">
                <mat-icon>event_busy</mat-icon>
                <p class="empty-state-text">No events available for {{ year }}</p>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card>
    </div>

    <!-- No Search Results -->
    <div class="no-results-state" *ngIf="samitiGroups.length === 0 && searchTerm">
      <mat-icon>search_off</mat-icon>
      <h3>No groups found</h3>
      <p>
        No groups match your search for "<strong>{{ searchTerm }}</strong>" and location "<strong>location</strong>"
      </p>
      <p class="suggestion">Try searching with a different group name, group ID.</p>
    </div>
  </section>
</div>
