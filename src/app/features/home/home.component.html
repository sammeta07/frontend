<div class="home-container">
  <section class="hero-section" *ngIf="locationName() && !searchTerm">
    <div class="hero-background-elements">
      <div class="hero-circle hero-circle-1"></div>
      <div class="hero-circle hero-circle-2"></div>
      <div class="hero-circle hero-circle-3"></div>
    </div>
    <div class="hero-content">
      <div class="hero-icon-wrapper">
        <mat-icon class="hero-main-icon">groups</mat-icon>
      </div>
      <h1 class="hero-title">Manage Your Samiti Digitally</h1>
      <p class="hero-subtitle">Apne Mandal ya Group ka hisaab-kitaab rakhein ekdam asaan aur transparent.</p>
      <div class="hero-actions">
        <button mat-raised-button color="primary" (click)="onCreateSamiti()" class="hero-primary-btn">
          <mat-icon>add</mat-icon>
          <span>CREATE NEW SAMITI</span>
        </button>
        <button mat-stroked-button class="hero-secondary-btn" (click)="scrollToGroups()">
          <mat-icon>explore</mat-icon>
          <span>BROWSE GROUPS</span>
        </button>
      </div>
    </div>
  </section>
  <hr class="section-divider" />
  <section class="near-you-section">
    <div class="section-header">
      <div class="section-title-group">
        <h2>
          Groups Near You
          <span *ngIf="samitiGroups.length > 0" class="group-count-badge">
            <mat-icon class="group-count-icon">groups</mat-icon>
            {{ samitiGroups.length }}
          </span>
        </h2>
        <p class="section-subtitle">Discover samiti groups in your area</p>
      </div>
      <div class="distance-filter-wrapper">
        <mat-form-field appearance="outline" class="distance-dropdown-modern enhanced-glass">
          <mat-label>
            <mat-icon class="location-icon-modern" aria-hidden="true">my_location</mat-icon>
            <span class="distance-label-title">Distance</span>
          </mat-label>
          <mat-select
            [(value)]="selectedDistance"
            (selectionChange)="onDistanceChange($event.value)"
            aria-label="Select distance radius"
            disableRipple
          >
            <mat-option *ngFor="let km of distanceOptions" [value]="km">
              <span class="distance-label-modern">Within <strong>{{ km }}</strong> km</span>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="group-grid" *ngIf="samitiGroups.length > 0">
      <mat-card class="group-card" *ngFor="let group of samitiGroups">
        <div class="group-header-enhanced">
          <div class="header-background"></div>
          <div class="header-content">
            <div class="header-main">
              <img [src]="group.logo || getGroupLogoUrl(group.name)" class="group-avatar" alt="{{group.name}}" />
              <div class="group-details">
                <h3 class="group-name clickable-title" (click)="openGroupProfile(group)">{{ group.name }}, <span>{{ group.locationName }}</span></h3>
                <div class="header-info">
                  <span class="distance-badge">
                    <mat-icon>near_me</mat-icon>
                    {{ group.distanceFromUser | number:'1.0-1' }} km away
                  </span>
                  <div class="info-divider"></div>
                  <div class="info-item">
                    <mat-icon>calendar_today</mat-icon>
                    <span>Since {{ group.since }}</span>
                  </div>
                  <div class="info-divider"></div>
                  <div class="info-item" [title]="group.events.length + ' Events'">
                    <mat-icon>event</mat-icon>
                    <span>{{ group.events.length }} Event{{ group.events.length !== 1 ? 's' : '' }}</span>
                  </div>
                  <div class="info-divider" *ngIf="group.contactNumbers && group.contactNumbers.length > 0"></div>
                  <div class="info-item" *ngIf="group.contactNumbers && group.contactNumbers.length > 0">
                    <mat-icon>phone</mat-icon>
                    <span>{{ group.contactNumbers.join(', ') }}</span>
                  </div>
                </div>
                <p class="group-description">{{ group.description }}</p>
              </div>
            </div>
            <div class="header-actions">
              <div class="group-id-info" *ngIf="group.groupId">
                <span class="group-id-label">Group Id:</span>
                <span class="group-id-value">{{ group.groupId }}</span>
                <button
                  mat-icon-button
                  type="button"
                  class="copy-icon"
                  (click)="copyToClipboard(group.groupId)"
                  aria-label="Copy Group ID"
                  title="Copy Group ID"
                >
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
              <button
                type="button"
                class="join-badge join-badge-large"
                (click)="$event.stopPropagation(); openJoinGroupDialog(group)"
              >
                <span style="font-size: 0.8rem; padding: 0 4px;">+ JOIN GROUP</span>
              </button>
            </div>
          </div>
        </div>
        <mat-tab-group mat-align-tabs="left" class="tabs-fixed-width" [selectedIndex]="selectedYearIndex">
          <mat-tab *ngFor="let year of years" [label]="year.toString()">
            <div class="events-section">
              <div class="events-grid-enhanced">
                <div class="event-card-enhanced" *ngFor="let event of group.events" [attr.data-status]="event.status">
                  <!-- Status indicator bar -->
                  <div class="event-status-bar" [attr.data-status]="event.status"></div>
                  <div class="event-card-body">
                    <swiper-container
                      *ngIf="event?.images?.length"
                      class="event-carousel"
                      [slidesPerView]="1"
                      [spaceBetween]="8"
                      [navigation]="true"
                      [pagination]="carouselPagination"
                      [autoplay]="carouselAutoplay"
                      [loop]="event.images.length > 2"
                    >
                      <swiper-slide *ngFor="let image of event.images">
                        <img class="event-carousel-image" [src]="image" [alt]="event.title + ' image'" loading="lazy" />
                      </swiper-slide>
                    </swiper-container>
                    <!-- Event Header -->
                    <div class="event-card-header">
                      <h5 class="event-card-title">{{ event.title }}</h5>
                      <span class="event-year-badge-new" [attr.data-status]="event.status">
                        ‚≠ê {{ getYearLabel(event.year_count) }}
                      </span>
                    </div>

                    <!-- Event Description -->
                    <p class="event-card-description">{{ event.description }}</p>

                    <!-- Event Meta Information -->
                    <div class="event-card-meta">
                      <div class="meta-row">
                        <mat-icon>calendar_today</mat-icon>
                        <span class="meta-text">
                          {{ event.start_date | date:'MMM d, yyyy' }} - {{ event.end_date | date:'MMM d, yyyy' }}
                        </span>
                      </div>

                      <div
                        class="meta-row clickable"
                        (click)="$event.stopPropagation(); openMap('event.locationName')"
                        title="Open in Maps"
                      >
                        <mat-icon>location_on</mat-icon>
                        <span class="meta-text">{{ event.location.lat | number:'1.4-4' }}, {{ event.location.long | number:'1.4-4' }}</span>
                        <mat-icon class="map-link-icon">open_in_new</mat-icon>
                      </div>
                    </div>

                    <!-- Event Footer -->
                    <div class="event-card-footer">
                      <span class="event-status-chip" [attr.data-status]="event.status">
                        <mat-icon>
                          {{ event.status === 'started' ? 'play_circle' : event.status === 'completed' ? 'check_circle' : 'schedule' }}
                        </mat-icon>
                        {{ event.status | titlecase }}
                      </span>
                      <button mat-button class="event-details-btn" (click)="openEventDetails(event)">
                        Details
                        <mat-icon>arrow_forward</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Empty State -->
              <div class="empty-state" *ngIf="locationName() && (!group.events || group.events.length === 0)">
                <mat-icon>event_busy</mat-icon>
                <p class="empty-state-text">No events available for {{ year }}</p>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card>
    </div>

    <!-- No Search Results -->
    <div class="no-results-state" *ngIf="samitiGroups.length === 0 && searchTerm">
      <mat-icon>search_off</mat-icon>
      <h3>No groups found</h3>
      <p>
        No groups match <strong>"{{ searchTerm }}"</strong>
        <ng-container *ngIf="locationName()"> near <strong>{{ locationName() }}</strong></ng-container>
      </p>
      <p class="suggestion">Try a different group name, group ID, or increase your distance radius.</p>
    </div>
  </section>
</div>